<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Deposit and Withdrawal</title>
	<link rel="stylesheet"
		href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.6.0/css/fontawesome.min.css"
		integrity="sha384-NvKbDTEnL+A8F/AA5Tc5kmMLSJHUO868P+lDtTpJIeQdGYaUIuLr4lVGOEA1OcMy" crossorigin="anonymous">
	<script src="https://cdn.jsdelivr.net/gh/ethereum/web3.js/dist/web3.min.js"></script>
	<style>
		* {
			margin: 0;
			padding: 0;
			box-sizing: border-box;
		}

		body {
			font-family: Arial, sans-serif;
			height: 100vh;
			width: 100vw;
			margin: 0;
			display: flex;
			flex-direction: column;
			min-height: 100vh;
			background-color: #f0f8ff;
		}

		.hidden-section h3 {
			font-size: 2.5em;

		}

		.hidden-section {
			display: none;
		}

		.table-container {
			max-height: 400px;
			overflow-y: auto;
			margin: 20px auto;
			width: 80%;
		}

		#scheduledWithdrawalsTable {
			width: 100%;
			table-layout: fixed;
			border-collapse: collapse;
		}

		#scheduledWithdrawalsTable {
			margin: 20px auto;
			width: 50%;
			table-layout: fixed;
			border-collapse: collapse;
		}

		#scheduledWithdrawalsTable th,
		#scheduledWithdrawalsTable td {
			border: 1px solid #ddd;
			padding: 8px;
			text-align: center;
			width: 20%;
		}

		input {
			width: 50%;
			height: 30px;
			padding: 20px 40px;
			margin-top: 30px;
			border: 1px solid #ccc;
			border-radius: 30px;
			background: #fafcff;
			box-shadow: 5px 5px 10px rgba(0, 0, 0, 0.2);
			display: flex;
			justify-content: center;
			align-items: center;
			overflow: hidden;

			&::-webkit-file-upload-button {
				padding: 6px;
				border-radius: 20px;
				border: 1px solid #ccc;
				background: linear-gradient(to bottom right, #f7fbff, #ccd1d8);
				cursor: pointer;
			}
		}

		#scheduledWithdrawalsTable th {
			background-color: #f2f2f2;
			font-weight: bold;
		}

		button {
			font-size: 1em;
			padding: 15px 30px;
			background: linear-gradient(to bottom right, #42b7f1, #2385e6);
			color: white;
			border: none;
			border-radius: 30px;
			cursor: pointer;
			box-shadow: 5px 5px 10px rgba(0, 0, 0, 0.2);
			transition: background-color 0.3s ease-in-out;
			margin: 5px;
		}

		button:hover {
			background: linear-gradient(to bottom right, rgb(29, 4, 90), #0d7aa5);
		}

		#status {
			margin-top: 20px;
			font-weight: bold;
		}

		html {
			scroll-behavior: smooth;
			/* Enables smooth scrolling for the whole page */
		}

		.side-bar {
			width: 250px;
			background: #b6f3fd;
			height: 100vh; /* Full height of the viewport */
			position: fixed;
			top: 67px;
			left: 0;
			transition: width 0.5s ease;
			padding: 50px 0;
			overflow-y: auto; /* Enable vertical scrolling */
		}

		.side-bar::-webkit-scrollbar {
			width: 10px;
			/* Width of the scrollbar */
		}

		.side-bar::-webkit-scrollbar-thumb {
			background: linear-gradient(180deg, #127b8e, #42b7f1);
			/* Gradient for the scrollbar thumb */
			border-radius: 20px;
			/* Rounded edges for the scrollbar */
		}

		.side-bar::-webkit-scrollbar-track {
			background: #c0e7f9;
			/* Light background for the scrollbar track */
		}

		.side-bar h1 {
			padding: 0 20px;
			margin-bottom: 20px;


		}

		.side-bar ul li {
			font-size: 20px;
			padding: 10px 20px;
			transition: 500ms background;
			white-space: nowrap;
			overflow: hidden;
			text-overflow: ellipsis;
			cursor: pointer;
		}

		.side-bar ul li:hover {
			background: #2385e6;
		}

		.side-bar ul {
			list-style-type: none;
			margin: 20px 0;
			/* Add space between each section */
			padding: 0;
			background-color: #b6f3fd;
			/* Background color for each section */
			border-radius: 10px;
			/* Rounded corners for sections */
			overflow: hidden;
			/* Hide any overflowing content */
		}

		.side-bar span {
			display: block;
			padding: 15px 20px;
			font-weight: bold;
			color: Blue;
			border-radius: 30px;
			margin-bottom: 10px;
			/* Separate header from the content */
			cursor: pointer;
		}

		.side-bar span:hover {
			background-color: #239ee6;
			color: white;
		}


		.navBar {
			display: none;
		}

		.navBar.show {
			display: block;
		}

		main {
			margin-left: 250px; /* Space for the sidebar */
			flex-grow: 1;
			padding: 20px;
			overflow-y: auto; /* Allow scrolling for the main content */
		}

		@media (max-width: 768px) {
			.side-bar {
				width: 200px; /* Change width for smaller screens */
			}

			main {
				margin-left: 200px; /* Adjust margin accordingly */
			}
		}
		header {
            background-color: #b6f3fd;
            color: blue;
            padding: 20px;
            text-align: center;
            font-size: 24px;
            font-weight: bold;
        }

        .content-wrapper {
            display: flex;
            flex-grow: 1;
        }
	</style>
</head>

<body>
	<header>
		Savings Account Management System
	</header>
	<nav class="side-bar">
		<span id="accountDetails" onclick="showSection('checkAccount')">Account Details</span>
		<span onclick="toggleNavBar('DepositAndWithdraw')">Deposit And Withdrawals</span>
		<ul id="DepositAndWithdraw" class="navBar">
			<li onclick="showSection('addFundsSection')">Add Funds</li>
			<li onclick="showSection('listScheduledSection'), listScheduledWithdrawals()">List Scheduled Withdrawals</li>
			<li onclick="showSection('instantWithdrawSection')">Instant Withdraw</li>
			<li onclick="showSection('scheduleWithdrawSection')">Schedule Withdraw</li>
			<li onclick="showSection('executeWithdrawSection')">Execute Withdrawal</li>
			<li onclick="showSection('cancelWithdrawal')">Cancel Scheduled Withdraw</li>
			<li onclick="showSection('childScheduleWithdraw')">Schedule Withdrawal for Child</li>
		</ul>

		<span onclick="toggleNavBar('Transaction')">Transaction</span>
		<ul id="Transaction" class="navBar">
			<li onclick="showSection('instantTransfer')">Instant Transfer</li>
			<li onclick="showSection('getAllScheduledTransfers')">All Scheduled Transfers</li>
			<li onclick="showSection('cancelScheduleTransfer')">Cancel Schedule Transfer</li>
			<li onclick="showSection('scheduleAutoExecutionTransfer')">Schedule Transfer</li>
			<li onclick="showSection('executeAutoScheduledTransfers')">Execute Scheduled Transfers</li>
			<li onclick="showSection('getTransferHistory')"> Transfer History</li>
			<li onclick="showSection('getAllTransferHistory')">All Transfer History</li>
			<li onclick="showSection('getTransferDetails')">Transfer Details</li>
			<li onclick="showSection('getTotalTransactionAmount')">Total Transaction Amount</li>

		</ul>

		<span onclick="toggleNavBar('Interest')">Interest</span>
        <ul id="Interest" class="navBar">
            <li onclick="showSection('interestAccountInfo')">Interest Account Information</li>
            <li onclick="showSection('interestCalculator')">Interest Calculator</li>
            <li onclick="showSection('addInterest')">Add Interest</li>
            <li onclick="showSection('withdrawInterest')">Withdraw Interest</li>
            <li onclick="showSection('distributeInterest')">Distribute Interest</li>
            <li onclick="showSection('interestIntervalAdjustment')">Interest Interval Adjustment</li>
            <li onclick="showSection('interestHistory')">Interest History</li>

        </ul>
		
		<span onclick="toggleNavBar('Reward')">Reward</span>
		<ul id="Reward" class="navBar">
			<li>Daily Reward</li>
			<li>Cashback on Transaction</li>
			<li>Reward Distribution</li>
			<li></li>
			<li></li>
			<li></li>
			<li></li>
			<li></li>
		</ul>
	</nav>
	<main>
		<!-- Display account info -->
		<div id="checkAccount" class="hidden-section" style="display: block;">
			<div>
				<h3>Account: <span id="account"></span></h3>
				<!-- <h3>Connected Smart Contract: <span id="contractArea"></span></h3> -->
				<!-- <button onclick="connectWallet()">Connect</button> -->
			</div>
			<!-- Check Balance Section -->
			<div>
				<h3>Check Balance: <span id="balanceResult"></span></h3>
				<!-- <button id="checkBalanceBtn">Check My Balance</button> -->
			</div>
			<!-- Get Current Block Timestamp -->
			<div class="blockTIme">
				<h3>Current Block Timestamp: <span id="timestampResult"></span></h3>
				<!-- <button id="getTimestampBtn">Get Block Timestamp</button> -->
			</div>
			<div>
				<!-- Child Check time remaining -->
				<h3>Time Remaining: <span id="timeRemainingResult"></span></h3>
				<!-- <button id="checkTimeBtn">Check Time Remaining</button> -->
			</div>
		</div>

		<!-- Add Funds Section -->
		<div id="addFundsSection" class="hidden-section">
			<form id="addFundsForm">
				<h3>Add Funds</h3>
				<input type="number" id="amount" name="amount" min="0.0001" step="0.0001" required
					placeholder="Enter Amount in Ether">
				<button type="submit">Add Funds</button>
			</form>
		</div>

		<!-- List Scheduled Withdrawals Section -->
		<div id="listScheduledSection" class="hidden-section" style="text-align: center; ">
			<h3>Scheduled Withdrawals</h3>
			<table id="scheduledWithdrawalsTable" border="1">
				<thead>
					<tr>
						<th>Index</th>
						<th>Amount (ETH)</th>
						<th>Unlock Time</th>
						<th>Active</th>
					</tr>
				</thead>
				<tbody id="withdrawalsBody"></tbody>
			</table>
		</div>

		<!-- Instant Withdraw Section -->
		<div id="instantWithdrawSection" class="hidden-section">
			<h3>Instant Withdraw</h3>
			<input type="number" id="instantWithdrawAmount" placeholder="Amount in ETH" /> <br>
			<button onclick="instantWithdraw()">Withdraw</button>
		</div>

		<!-- Schedule Withdrawal Section -->
		<div id="scheduleWithdrawSection" class="hidden-section">
			<h3>Schedule Withdrawal</h3>
			<input type="number" id="withdrawAmount" placeholder="Amount in ETH" /> <br>
			<input type="datetime-local" id="withdrawDateTime" /> <br>
			<button onclick="addScheduleWithdraw()">Schedule Withdraw</button>
		</div>

		<!-- Execute Withdrawal Section -->
		<div id="executeWithdrawSection" class="hidden-section">
			<h3>Execute Scheduled Withdrawal</h3>
			<input type="number" id="withdrawIndex" placeholder="Withdrawal Index" /> <br>
			<button onclick="executeScheduledWithdraw()">Execute Withdrawal</button>
		</div>

		<!-- Cancel Scheduled Withdraw -->
		<div id="cancelWithdrawal" class="hidden-section">
			<form id="cancelWithdrawalForm">
				<h3>Cancel Scheduled Withdraw</h3>
				<input type="number" id="withdrawalIndex" name="withdrawalIndex" min="0" required
					placeholder="Enter index Schedule Withdraw">
				<button type="submit">Cancel Withdrawal</button>
			</form>
			<p id="cancelResponse"></p>
		</div>

		<div id="childScheduleWithdraw" class="hidden-section">
			<form id="withdrawForm">
				<h3>Schedule Withdrawal for Child</h3>
				<label for="childAddress">Child's Address:</label><br>
				<input type="text" id="childAddress" name="childAddress" placeholder="Enter child's address"
					required><br><br>

				<label for="amountWithdraw">Amount (in Ether):</label><br>
				<input type="number" id="amountWithdraw" name="amountWithdraw" placeholder="Enter amount in Ether"
					required><br><br>

				<label for="unlockTime">Unlock Date:</label><br>
				<input type="datetime-local" id="unlockTime" name="unlockTime" required><br><br>

				<button type="submit">Schedule Withdrawal</button>
			</form>
		</div>

		<div id="status"></div>

		<div id="instantTransfer" class="hidden-section">
			<h2>Instant Transfer</h2>
			<input type="text" id="instantTransferTo" placeholder="To Address">
			<input type="number" id="instantTransferAmount" placeholder="Amount in Ether">
			<button onclick="instantTransfer()">Transfer</button>
		</div>


		<div id="getAllScheduledTransfers" class="hidden-section">
			<h2>List All Scheduled Transfers</h2>
			<button onclick="getAllScheduledTransfers()">Get All Scheduled Transfers</button>
		</div>


		<div id="cancelScheduleTransfer" class="hidden-section">
			<h2>Cancel Scheduled Transfer</h2>
			<input type="number" id="cancelTransferIndex" placeholder="Transfer Index">
			<button onclick="cancelScheduledTransfer()">Cancel Transfer</button>
		</div>


		<div id="scheduleAutoExecutionTransfer" class="hidden-section"">
			<h2>Schedule Execution Transfer</h2>
			<input type=" text" id="autoScheduleTransferTo" placeholder="To Address">
			<input type="number" id="autoScheduleTransferAmount" placeholder="Amount in Ether">
			<input type="datetime-local" id="autoScheduleTransferUnlockTime" placeholder="Unlock Time">
			<button onclick="scheduleAutoExecution()">Schedule Execution</button>
		</div>


		<div id="executeAutoScheduledTransfers" class="hidden-section">
			<h2>Execute Scheduled Transfers</h2>
			<button onclick="executeAutoScheduledTransfers()">Execute Auto Scheduled Transfers</button>
		</div>


		<div id="getTransferHistory" class="hidden-section">
			<h2>Transfer History</h2>
			<input type="text" id="transferHistoryUser1" placeholder="User 1 Address">
			<input type="text" id="transferHistoryUser2" placeholder="User 2 Address">
			<button onclick="getTransferHistory()">Get History</button>
		</div>


		<div id="getAllTransferHistory" class="hidden-section">
			<h2>All Transfer History</h2>
			<input type="text" id="allTransferHistoryUser" placeholder="User Address">
			<button onclick="getAllTransferHistory()">Get All History</button>
		</div>


		<div id="getTransferDetails" class="hidden-section">
			<h2>Transfer Details</h2>
			<input type="text" id="transferDetailsUser" placeholder="User Address">
			<input type="number" id="transferDetailsIndex" placeholder="Transfer Index">
			<button onclick="getTransferDetails()">Get Details</button>
		</div>


		<div id="getTotalTransactionAmount" class="hidden-section">
			<h2>Total Transaction Amount</h2>
			<input type="text" id="totalAmountSender" placeholder="Sender Address">
			<input type="text" id="totalAmountReceiver" placeholder="Receiver Address">
			<button onclick="getTotalTransactionAmount()">Get Total Amount</button>
		</div>

        <!-- WenKang Interest Module -->
        <div id="interestAccountInfo" class="hidden-section">
            <button onclick="connectWallet()">connectWallet</button>
            <h3>Connected Account: <span id="account"></span></h3>

            <h2>Account Information</h2>
            <p>Account Balance: <span id="account-balance">0 ETH</span></p> <!-- Changed from account-balances -->
            <p>Accrual Interval: <span id="accrual-interval">Unknown</span></p>
            <p>Interest Rate: <span id="interest-rate">0%</span></p>

            <button id="refresh-account-info" onclick="refreshAccountInfo()">Refresh Account Info</button> <!-- Changed from refreshAccountInfo -->
        </div>

        <!-- Interest Calculator -->
        <div id="interestCalculator" class="hidden-section">
            <h3>Interest Calculator</h3>
            <label for="calc-amount">Amount (ETH):</label>
            <input type="number" id="calc-amount" placeholder="Amount in ETH">
            <label for="startTime">Start Date:</label>
            <input type="datetime-local" id="startTime" name="startTime">
            <label for="endTime">End Date:</label>
            <input type="datetime-local" id="endTime" name="endTime">
            <button id="calculate-interest">Calculate Interest</button>
            <p>Interest (Testing): <span id="interest-test">0 ETH</span></p>
            <p>Interest (Monthly): <span id="interest-month">0 ETH</span></p>
            <p>Interest (Yearly): <span id="interest-year">0 ETH</span></p>
        </div>

        <!-- Add Interest -->
        <div id="addInterest" class="hidden-section">
            <h2>Account Information</h2>
            <p>Account Balance: <span id="account-balance">0 ETH</span></p> <!-- Keep same id as above -->
            <p>Accrual Interval: <span id="accrual-interval">Unknown</span></p>
            <p>Interest Rate: <span id="interest-rate">0%</span></p>
            <button id="refresh-account">Refresh Account Info</button>

            <h3>Add Interest</h3>
            <button id="add-interest">Add Interest</button>
            <p>Status: <span id="add-interest-status">Not added yet</span></p>
        </div>

        <!-- Withdraw Interest -->
        <div id="withdrawInterest" class="hidden-section">
            <h2>Account Information</h2>
            <p>Account Balance: <span id="account-balance">0 ETH</span></p> <!-- Keep same id as above -->
            <p>Accrual Interval: <span id="accrual-interval">Unknown</span></p>
            <p>Interest Rate: <span id="interest-rate">0%</span></p>
            <button id="refresh-account">Refresh Account Info</button>

            <h3>Withdraw Interest</h3>
            <button id="withdraw-interest">Withdraw Interest</button>
            <p>Status: <span id="withdraw-interest-status">Not withdrawn yet</span></p>
        </div>

        <!-- Distribute Interest -->
        <div id="distributeInterest" class="hidden-section">
            <h2>Account Information</h2>
            <p>Account Balance: <span id="account-balance">0 ETH</span></p> <!-- Keep same id as above -->
            <p>Accrual Interval: <span id="accrual-interval">Unknown</span></p>
            <p>Interest Rate: <span id="interest-rate">0%</span></p>
            <button id="refresh-account">Refresh Account Info</button>

            <h2>Distribute Interest</h2>
            <label for="Recipient-Address">Recipient Address :</label>
            <input type="text" id="Recipient-Address"  value="Child / Parent Address">
            <label for="distribute-Percentage">Distribute Percentage(%) :</label>
            <input type="number" id="distribute-percentage" min="1" max="100" placeholder="Percentage to distribute"> <!-- Changed distribute-Percentage to distribute-percentage -->

            <button id="distribute-interest">Distribute Interest</button> <!-- Changed from distributeInterest -->
            <p>Status: <span id="distribute-interest-status">Not distributed yet</span></p> <!-- Changed from withdraw-interest-status -->
        </div>

        <!-- Change Interval -->
        <div id="interestIntervalAdjustment" class="hidden-section">
            <h2>Change Accrual Interval</h2>
            <label for="interval-select">Choose Interval:</label>
            <select id="interval-select">
                <option value="2592000">Monthly</option>
                <option value="31536000">Yearly</option>
                <option value="30">Testing (30s)</option>
            </select>
            <button id="change-interval">Change Interval</button>
            <p>Status: <span id="change-interval-status">Interval not changed yet</span></p>
        </div>

        <!-- Interest Histories -->
        <div id="interestHistory" class="hidden-section">
            <h2>Interest Histories</h2>
            <button id="fetch-history" onclick="getInterestHistory()">Fetch History</button>
            <h3>Withdrawal History</h3>
            <ul id="withdrawal-history"></ul>

            <h3>Add Interest History</h3>
            <ul id="add-interest-history"></ul>

            <h3>Distribution History</h3>
            <ul id="distribution-history"></ul>
        </div>
		
	</main>


	<script>
		let account;
		let web3;
		let contract;

		// Define the ABI and contract address globally
		const ABI = [
	{
		"inputs": [],
		"stateMutability": "nonpayable",
		"type": "constructor"
	},
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": true,
				"internalType": "address",
				"name": "user",
				"type": "address"
			},
			{
				"indexed": false,
				"internalType": "uint256",
				"name": "timestamp",
				"type": "uint256"
			}
		],
		"name": "AccountArchived",
		"type": "event"
	},
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": true,
				"internalType": "address",
				"name": "user",
				"type": "address"
			},
			{
				"indexed": false,
				"internalType": "uint256",
				"name": "timestamp",
				"type": "uint256"
			}
		],
		"name": "AccountReactivated",
		"type": "event"
	},
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": true,
				"internalType": "address",
				"name": "parent",
				"type": "address"
			},
			{
				"indexed": false,
				"internalType": "address",
				"name": "child",
				"type": "address"
			}
		],
		"name": "ChildAccountAdded",
		"type": "event"
	},
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": true,
				"internalType": "address",
				"name": "account",
				"type": "address"
			},
			{
				"indexed": false,
				"internalType": "uint256",
				"name": "amount",
				"type": "uint256"
			}
		],
		"name": "FundsAdded",
		"type": "event"
	},
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": true,
				"internalType": "address",
				"name": "parent",
				"type": "address"
			},
			{
				"indexed": true,
				"internalType": "address",
				"name": "child",
				"type": "address"
			},
			{
				"indexed": false,
				"internalType": "uint256",
				"name": "timestamp",
				"type": "uint256"
			}
		],
		"name": "ModificationAccessGranted",
		"type": "event"
	},
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": true,
				"internalType": "address",
				"name": "parent",
				"type": "address"
			},
			{
				"indexed": true,
				"internalType": "address",
				"name": "child",
				"type": "address"
			},
			{
				"indexed": false,
				"internalType": "uint256",
				"name": "timestamp",
				"type": "uint256"
			}
		],
		"name": "ModificationAccessRevoked",
		"type": "event"
	},
	{
		"anonymous": false,
		"inputs": [],
		"name": "Paused",
		"type": "event"
	},
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": true,
				"internalType": "address",
				"name": "user",
				"type": "address"
			},
			{
				"indexed": false,
				"internalType": "string",
				"name": "name",
				"type": "string"
			},
			{
				"indexed": false,
				"internalType": "string",
				"name": "email",
				"type": "string"
			},
			{
				"indexed": false,
				"internalType": "uint256",
				"name": "age",
				"type": "uint256"
			},
			{
				"indexed": false,
				"internalType": "uint256",
				"name": "timestamp",
				"type": "uint256"
			}
		],
		"name": "ProfileModified",
		"type": "event"
	},
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": true,
				"internalType": "address",
				"name": "sender",
				"type": "address"
			},
			{
				"indexed": false,
				"internalType": "uint256",
				"name": "amount",
				"type": "uint256"
			},
			{
				"indexed": false,
				"internalType": "uint256",
				"name": "index",
				"type": "uint256"
			}
		],
		"name": "ScheduledTransferCancelled",
		"type": "event"
	},
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": true,
				"internalType": "address",
				"name": "sender",
				"type": "address"
			},
			{
				"indexed": true,
				"internalType": "address",
				"name": "receiver",
				"type": "address"
			},
			{
				"indexed": false,
				"internalType": "uint256",
				"name": "amount",
				"type": "uint256"
			},
			{
				"indexed": false,
				"internalType": "uint256",
				"name": "unlockTime",
				"type": "uint256"
			}
		],
		"name": "ScheduledTransferCreated",
		"type": "event"
	},
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": true,
				"internalType": "address",
				"name": "sender",
				"type": "address"
			},
			{
				"indexed": true,
				"internalType": "address",
				"name": "receiver",
				"type": "address"
			},
			{
				"indexed": false,
				"internalType": "uint256",
				"name": "amount",
				"type": "uint256"
			},
			{
				"indexed": false,
				"internalType": "uint256",
				"name": "index",
				"type": "uint256"
			}
		],
		"name": "ScheduledTransferExecuted",
		"type": "event"
	},
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": true,
				"internalType": "address",
				"name": "account",
				"type": "address"
			},
			{
				"indexed": false,
				"internalType": "uint256",
				"name": "amount",
				"type": "uint256"
			},
			{
				"indexed": false,
				"internalType": "uint256",
				"name": "index",
				"type": "uint256"
			}
		],
		"name": "ScheduledWithdrawCancelled",
		"type": "event"
	},
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": true,
				"internalType": "address",
				"name": "account",
				"type": "address"
			},
			{
				"indexed": false,
				"internalType": "uint256",
				"name": "amount",
				"type": "uint256"
			},
			{
				"indexed": false,
				"internalType": "uint256",
				"name": "unlockTime",
				"type": "uint256"
			}
		],
		"name": "ScheduledWithdrawCreated",
		"type": "event"
	},
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": true,
				"internalType": "address",
				"name": "account",
				"type": "address"
			},
			{
				"indexed": false,
				"internalType": "uint256",
				"name": "amount",
				"type": "uint256"
			},
			{
				"indexed": false,
				"internalType": "uint256",
				"name": "index",
				"type": "uint256"
			}
		],
		"name": "ScheduledWithdrawExecuted",
		"type": "event"
	},
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": true,
				"internalType": "address",
				"name": "sender",
				"type": "address"
			},
			{
				"indexed": true,
				"internalType": "address",
				"name": "receiver",
				"type": "address"
			},
			{
				"indexed": false,
				"internalType": "uint256",
				"name": "amount",
				"type": "uint256"
			}
		],
		"name": "TransferExecuted",
		"type": "event"
	},
	{
		"anonymous": false,
		"inputs": [],
		"name": "Unpaused",
		"type": "event"
	},
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": true,
				"internalType": "address",
				"name": "user",
				"type": "address"
			},
			{
				"indexed": false,
				"internalType": "uint256",
				"name": "timestamp",
				"type": "uint256"
			}
		],
		"name": "UserLoggedIn",
		"type": "event"
	},
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": true,
				"internalType": "address",
				"name": "user",
				"type": "address"
			},
			{
				"indexed": false,
				"internalType": "string",
				"name": "name",
				"type": "string"
			},
			{
				"indexed": false,
				"internalType": "string",
				"name": "email",
				"type": "string"
			},
			{
				"indexed": false,
				"internalType": "uint256",
				"name": "age",
				"type": "uint256"
			},
			{
				"indexed": false,
				"internalType": "uint256",
				"name": "timestamp",
				"type": "uint256"
			}
		],
		"name": "UserRegistered",
		"type": "event"
	},
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": true,
				"internalType": "address",
				"name": "account",
				"type": "address"
			},
			{
				"indexed": false,
				"internalType": "uint256",
				"name": "amount",
				"type": "uint256"
			}
		],
		"name": "WithdrawalMade",
		"type": "event"
	},
	{
		"inputs": [],
		"name": "SECONDS_IN_A_YEAR",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "",
				"type": "address"
			}
		],
		"name": "accounts",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "balance",
				"type": "uint256"
			},
			{
				"internalType": "uint256",
				"name": "startTime",
				"type": "uint256"
			},
			{
				"internalType": "uint256",
				"name": "contractEndTime",
				"type": "uint256"
			},
			{
				"internalType": "address",
				"name": "parent",
				"type": "address"
			},
			{
				"internalType": "bool",
				"name": "isChild",
				"type": "bool"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "addFunds",
		"outputs": [],
		"stateMutability": "payable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "_amount",
				"type": "uint256"
			},
			{
				"internalType": "uint256",
				"name": "_unlockTime",
				"type": "uint256"
			}
		],
		"name": "addScheduleWithdraw",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "_child",
				"type": "address"
			},
			{
				"internalType": "uint256",
				"name": "_amountWithdraw",
				"type": "uint256"
			},
			{
				"internalType": "uint256",
				"name": "_unlockTime",
				"type": "uint256"
			}
		],
		"name": "addScheduleWithdrawForChild",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "archiveAccount",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "_index",
				"type": "uint256"
			}
		],
		"name": "cancelScheduleWithdraw",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "_index",
				"type": "uint256"
			}
		],
		"name": "cancelScheduledTransfer",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "checkArchiveStatus",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "checkMyBalance",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "_child",
				"type": "address"
			}
		],
		"name": "checkTimeRemaining",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "",
				"type": "address"
			},
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"name": "children",
		"outputs": [
			{
				"internalType": "address",
				"name": "",
				"type": "address"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "userAddress",
				"type": "address"
			}
		],
		"name": "copyUserToAccount",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "deleteAccount",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "executeAutoScheduledTransfers",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "_index",
				"type": "uint256"
			}
		],
		"name": "executeScheduledWithdraw",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "getAllScheduledTransfers",
		"outputs": [
			{
				"internalType": "address[]",
				"name": "receivers",
				"type": "address[]"
			},
			{
				"internalType": "uint256[]",
				"name": "amounts",
				"type": "uint256[]"
			},
			{
				"internalType": "uint256[]",
				"name": "unlockTimes",
				"type": "uint256[]"
			},
			{
				"internalType": "bool[]",
				"name": "activeStatuses",
				"type": "bool[]"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "_user",
				"type": "address"
			}
		],
		"name": "getAllTransferHistory",
		"outputs": [
			{
				"components": [
					{
						"internalType": "address",
						"name": "sender",
						"type": "address"
					},
					{
						"internalType": "address",
						"name": "receiver",
						"type": "address"
					},
					{
						"internalType": "uint256",
						"name": "amount",
						"type": "uint256"
					},
					{
						"internalType": "uint256",
						"name": "timestamp",
						"type": "uint256"
					}
				],
				"internalType": "struct DepositAndWithdraw.TransferRecord[]",
				"name": "",
				"type": "tuple[]"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "_account",
				"type": "address"
			}
		],
		"name": "getArchiveTimestamp",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "_parent",
				"type": "address"
			}
		],
		"name": "getChildren",
		"outputs": [
			{
				"internalType": "address[]",
				"name": "",
				"type": "address[]"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "getCurrentBlockTimestamp",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "_child",
				"type": "address"
			}
		],
		"name": "getParent",
		"outputs": [
			{
				"components": [
					{
						"internalType": "address",
						"name": "account",
						"type": "address"
					},
					{
						"internalType": "string",
						"name": "name",
						"type": "string"
					},
					{
						"internalType": "string",
						"name": "email",
						"type": "string"
					},
					{
						"internalType": "uint256",
						"name": "age",
						"type": "uint256"
					},
					{
						"internalType": "enum DepositAndWithdraw.AccountType",
						"name": "accountType",
						"type": "uint8"
					},
					{
						"internalType": "address",
						"name": "parent",
						"type": "address"
					},
					{
						"internalType": "enum DepositAndWithdraw.AccountStatus",
						"name": "status",
						"type": "uint8"
					},
					{
						"internalType": "uint256",
						"name": "archiveTimestamp",
						"type": "uint256"
					}
				],
				"internalType": "struct DepositAndWithdraw.User",
				"name": "",
				"type": "tuple"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "getProfile",
		"outputs": [
			{
				"components": [
					{
						"internalType": "address",
						"name": "account",
						"type": "address"
					},
					{
						"internalType": "string",
						"name": "name",
						"type": "string"
					},
					{
						"internalType": "string",
						"name": "email",
						"type": "string"
					},
					{
						"internalType": "uint256",
						"name": "age",
						"type": "uint256"
					},
					{
						"internalType": "enum DepositAndWithdraw.AccountType",
						"name": "accountType",
						"type": "uint8"
					},
					{
						"internalType": "address",
						"name": "parent",
						"type": "address"
					},
					{
						"internalType": "enum DepositAndWithdraw.AccountStatus",
						"name": "status",
						"type": "uint8"
					},
					{
						"internalType": "uint256",
						"name": "archiveTimestamp",
						"type": "uint256"
					}
				],
				"internalType": "struct DepositAndWithdraw.User",
				"name": "",
				"type": "tuple"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "_user",
				"type": "address"
			}
		],
		"name": "getTimeUntilDeletion",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "_sender",
				"type": "address"
			},
			{
				"internalType": "address",
				"name": "_receiver",
				"type": "address"
			}
		],
		"name": "getTotalTransactionAmount",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "_user",
				"type": "address"
			},
			{
				"internalType": "uint256",
				"name": "_index",
				"type": "uint256"
			}
		],
		"name": "getTransferDetails",
		"outputs": [
			{
				"internalType": "address",
				"name": "sender",
				"type": "address"
			},
			{
				"internalType": "address",
				"name": "receiver",
				"type": "address"
			},
			{
				"internalType": "uint256",
				"name": "amount",
				"type": "uint256"
			},
			{
				"internalType": "uint256",
				"name": "timestamp",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "_user1",
				"type": "address"
			},
			{
				"internalType": "address",
				"name": "_user2",
				"type": "address"
			}
		],
		"name": "getTransferHistory",
		"outputs": [
			{
				"components": [
					{
						"internalType": "address",
						"name": "sender",
						"type": "address"
					},
					{
						"internalType": "address",
						"name": "receiver",
						"type": "address"
					},
					{
						"internalType": "uint256",
						"name": "amount",
						"type": "uint256"
					},
					{
						"internalType": "uint256",
						"name": "timestamp",
						"type": "uint256"
					}
				],
				"internalType": "struct DepositAndWithdraw.TransferRecord[]",
				"name": "",
				"type": "tuple[]"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "_user",
				"type": "address"
			}
		],
		"name": "getUserStatus",
		"outputs": [
			{
				"internalType": "string",
				"name": "",
				"type": "string"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "_child",
				"type": "address"
			}
		],
		"name": "grantModificationAccess",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "_to",
				"type": "address"
			},
			{
				"internalType": "uint256",
				"name": "_amount",
				"type": "uint256"
			}
		],
		"name": "instantTransfer",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "_account",
				"type": "address"
			}
		],
		"name": "listScheduledWithdrawals",
		"outputs": [
			{
				"components": [
					{
						"internalType": "address",
						"name": "recipient",
						"type": "address"
					},
					{
						"internalType": "uint256",
						"name": "amount",
						"type": "uint256"
					},
					{
						"internalType": "uint256",
						"name": "unlockTime",
						"type": "uint256"
					},
					{
						"internalType": "bool",
						"name": "active",
						"type": "bool"
					}
				],
				"internalType": "struct DepositAndWithdraw.ScheduledWithdraw[]",
				"name": "",
				"type": "tuple[]"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "_account",
				"type": "address"
			}
		],
		"name": "login",
		"outputs": [
			{
				"internalType": "bool",
				"name": "",
				"type": "bool"
			}
		],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "_newAddress",
				"type": "address"
			}
		],
		"name": "migrateAccount",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "",
				"type": "address"
			}
		],
		"name": "modificationAccessGranted",
		"outputs": [
			{
				"internalType": "bool",
				"name": "",
				"type": "bool"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "string",
				"name": "_name",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "_email",
				"type": "string"
			},
			{
				"internalType": "uint256",
				"name": "_age",
				"type": "uint256"
			}
		],
		"name": "modifyProfile",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "owner",
		"outputs": [
			{
				"internalType": "address",
				"name": "",
				"type": "address"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "pause",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "paused",
		"outputs": [
			{
				"internalType": "bool",
				"name": "",
				"type": "bool"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "reactivateAccount",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "string",
				"name": "_name",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "_email",
				"type": "string"
			},
			{
				"internalType": "uint256",
				"name": "_age",
				"type": "uint256"
			},
			{
				"internalType": "address",
				"name": "_parent",
				"type": "address"
			},
			{
				"internalType": "enum DepositAndWithdraw.AccountType",
				"name": "_accountType",
				"type": "uint8"
			}
		],
		"name": "register",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "_child",
				"type": "address"
			}
		],
		"name": "revokeModificationAccess",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "_to",
				"type": "address"
			},
			{
				"internalType": "uint256",
				"name": "_amount",
				"type": "uint256"
			},
			{
				"internalType": "uint256",
				"name": "_unlockTime",
				"type": "uint256"
			}
		],
		"name": "scheduleAutoExecution",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "",
				"type": "address"
			},
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"name": "scheduledTransfers",
		"outputs": [
			{
				"internalType": "address",
				"name": "sender",
				"type": "address"
			},
			{
				"internalType": "address",
				"name": "receiver",
				"type": "address"
			},
			{
				"internalType": "uint256",
				"name": "amount",
				"type": "uint256"
			},
			{
				"internalType": "uint256",
				"name": "unlockTime",
				"type": "uint256"
			},
			{
				"internalType": "bool",
				"name": "active",
				"type": "bool"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "",
				"type": "address"
			},
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"name": "scheduledWithdrawals",
		"outputs": [
			{
				"internalType": "address",
				"name": "recipient",
				"type": "address"
			},
			{
				"internalType": "uint256",
				"name": "amount",
				"type": "uint256"
			},
			{
				"internalType": "uint256",
				"name": "unlockTime",
				"type": "uint256"
			},
			{
				"internalType": "bool",
				"name": "active",
				"type": "bool"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "",
				"type": "address"
			},
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"name": "transferHistory",
		"outputs": [
			{
				"internalType": "address",
				"name": "sender",
				"type": "address"
			},
			{
				"internalType": "address",
				"name": "receiver",
				"type": "address"
			},
			{
				"internalType": "uint256",
				"name": "amount",
				"type": "uint256"
			},
			{
				"internalType": "uint256",
				"name": "timestamp",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "unpause",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "",
				"type": "address"
			}
		],
		"name": "users",
		"outputs": [
			{
				"internalType": "address",
				"name": "account",
				"type": "address"
			},
			{
				"internalType": "string",
				"name": "name",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "email",
				"type": "string"
			},
			{
				"internalType": "uint256",
				"name": "age",
				"type": "uint256"
			},
			{
				"internalType": "enum DepositAndWithdraw.AccountType",
				"name": "accountType",
				"type": "uint8"
			},
			{
				"internalType": "address",
				"name": "parent",
				"type": "address"
			},
			{
				"internalType": "enum DepositAndWithdraw.AccountStatus",
				"name": "status",
				"type": "uint8"
			},
			{
				"internalType": "uint256",
				"name": "archiveTimestamp",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "_amount",
				"type": "uint256"
			}
		],
		"name": "withdraw",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	}
];
		const Address = "0x6a1b0050303c376f9a21Acb679232f6A9650D325"; // Replace with your contract address

		// Function to show the correct section and hide others
		function showSection(sectionId) {
			const sections = document.querySelectorAll('.hidden-section');
			sections.forEach(section => section.style.display = 'none');  // Hide all sections
			document.getElementById(sectionId).style.display = 'block';  // Show the selected section
		}

		function toggleNavBar(id) {
			const nav = document.getElementById(id);
			nav.classList.toggle('show');
		}
		function toggleSection(sectionId) {
    const sections = document.querySelectorAll('.content-section');
    sections.forEach(section => section.style.display = 'none');
    const selectedSection = document.getElementById(sectionId);
    if (selectedSection) {
        selectedSection.style.display = 'block';
    }
		}

		// Connect MetaMask Wallet
		async function connectWallet() {
			if (window.ethereum) {
				try {
					const accounts = await ethereum.request({ method: 'eth_requestAccounts' });
					account = accounts[0];
					document.getElementById('account').innerText = account;
					web3 = new Web3(window.ethereum); // Instantiate web3 with MetaMask provider
					contract = new web3.eth.Contract(ABI, Address); // Instantiate the contract
					document.getElementById('contractArea').innerText = "Transaction Smart Contract";
				} catch (error) {
					console.error("User denied account access", error);
					alert("Error connecting wallet. Check console for details.");
				}
			} else {
				alert("Please install MetaMask!");
			}
		}

		// Checking the balance
		const checkBalance = document.getElementById('accountDetails');
		checkBalance.addEventListener('click', async () => {
			const accounts = await web3.eth.getAccounts();
			const sender = accounts[0];

			contract.methods.checkMyBalance().call({ from: sender })
				.then((balance) => {
					const etherBalance = web3.utils.fromWei(balance, 'ether');
					document.getElementById('balanceResult').innerText = `${etherBalance} ETH`;
				})
				.catch((error) => {
					document.getElementById('balanceResult').innerText = `Please coonect to MetaMask`;
				});
		});

		// Fetch and display the current block timestamp
		const getTimestamp = document.getElementById('accountDetails');
		getTimestamp.addEventListener('click', async () => {
			try {
				const timestamp = await contract.methods.getCurrentBlockTimestamp().call();
				document.getElementById('timestampResult').innerText = `${timestamp}`;
			} catch (error) {
				document.getElementById('timestampResult').innerText = `Please connect to MetaMask`;
			}
		});

		// Handle checking time remaining
		const checkTime = document.getElementById('accountDetails');
		checkTime.addEventListener('click', async () => {
			const accounts = await web3.eth.getAccounts();
			const sender = accounts[0];

			contract.methods.checkTimeRemaining(sender).call({
				from: sender
			})
				.then((timeRemaining) => {
					if (timeRemaining == 0) {
						document.getElementById('timeRemainingResult').innerText = "No time remaining (contract ended).";
					} else {
						// Convert seconds to a human-readable format (days, hours, minutes)
						const days = Math.floor(timeRemaining / (3600 * 24));
						const hours = Math.floor((timeRemaining % (3600 * 24)) / 3600);
						const minutes = Math.floor((timeRemaining % 3600) / 60);
						const seconds = timeRemaining % 60;

						document.getElementById('timeRemainingResult').innerText =
							`${days} days, ${hours} hours, ${minutes} minutes, ${seconds} seconds`;
					}
				})
				.catch((error) => {
					document.getElementById('timeRemainingResult').innerText = `Error: ${error.message}`;
				});
		});

		// Add Funds to the contract
		const addFundsForm = document.getElementById('addFundsForm');
		addFundsForm.addEventListener('submit', async (e) => {
			e.preventDefault();
			const amount = document.getElementById('amount').value;
			const accounts = await web3.eth.getAccounts();
			const sender = accounts[0];

			contract.methods.addFunds().send({
				from: sender,
				value: web3.utils.toWei(amount, 'ether')
			})
				.then((receipt) => {
					document.getElementById('fundsResponse').innerText = 'Funds added successfully!';
				})
				.catch((error) => {
					document.getElementById('fundsResponse').innerText = `Error`;
				});
		});

		// Function to withdraw instantly
		async function instantWithdraw() {
			const amount = document.getElementById('instantWithdrawAmount').value;

			if (amount > 0) {
				try {
					await contract.methods.withdraw(web3.utils.toWei(amount, 'ether')).send({ from: account });
					alert("Instant withdrawal successful!");
				} catch (error) {
					console.error("Error withdrawing instantly:", error);
					alert("Error in instant withdrawal. Check console for details.");
				}
			} else {
				alert("Please enter a valid withdrawal amount.");
			}
		}

		// List all scheduled withdrawals for the connected account and display them in a table
		async function listScheduledWithdrawals() {
			try {
				// Fetch the scheduled withdrawals from the contract
				const scheduledWithdrawals = await contract.methods.listScheduledWithdrawals(account).call();

				// Get the table body where the rows will be populated
				const tableBody = document.getElementById('withdrawalsBody');

				// Clear previous rows
				tableBody.innerHTML = '';

				// Loop through the scheduled withdrawals and populate the table
				scheduledWithdrawals.forEach((withdrawal, index) => {
					const amount = web3.utils.fromWei(withdrawal.amount, 'ether');  // Convert amount from Wei to ETH
					const unlockTime = new Date(withdrawal.unlockTime * 1000).toLocaleString();  // Convert UNIX timestamp to readable date
					const isActive = withdrawal.active ? 'Yes' : 'No';  // Check if withdrawal is still active

					// Create a new row for each scheduled withdrawal
					const row = document.createElement('tr');
					row.innerHTML = `
                        <td>${index}</td>
                        <td>${amount}</td>
                        <td>${unlockTime}</td>
                        <td>${isActive}</td>
                    `;

					// Append the new row to the table body
					tableBody.appendChild(row);
				});
			} catch (error) {
				console.error("Error listing scheduled withdrawals:", error);
			}
		}

		// Call listScheduledWithdrawals initially to display withdrawals when the page loads
		window.onload = listScheduledWithdrawals;

		// Add a child account
		async function addChildAccount() {
			const childAddress = document.getElementById('childAddress').value;
			if (web3.utils.isAddress(childAddress)) {
				try {
					await contract.methods.addChildAccount(childAddress).send({ from: account });
					alert("Child account added successfully!");
				} catch (error) {
					console.error("Error adding child account:", error);
					alert("Error adding child account. Check console for details.");
				}
			} else {
				alert("Please enter a valid child address.");
			}
		}

		// Schedule withdrawal for the child account
		async function addScheduleWithdraw() {
			const amount = document.getElementById('withdrawAmount').value;
			const datetimeInput = document.getElementById('withdrawDateTime').value;
			const date = new Date(datetimeInput);
			const unlockPeriod = Math.floor(date.getTime() / 1000); // Correctly getting the unlock time in seconds

			const timestamp = await contract.methods.getCurrentBlockTimestamp().call();

			if (amount > 0 && unlockPeriod > timestamp) {
				try {
					await contract.methods.addScheduleWithdraw(
						web3.utils.toWei(amount, 'ether'),
						unlockPeriod // Use the numeric unlockPeriod here
					).send({ from: account });
					alert("Scheduled withdrawal successfully!");
				} catch (error) {
					console.error("Error scheduling withdrawal:", error);
					alert("Error scheduling withdrawal. Check console for details.");
				}
			} else {
				alert("Please enter a valid amount and unlock period.");
			}
		}

		// Execute scheduled withdrawal
		async function executeScheduledWithdraw() {
			const withdrawIndex = document.getElementById('withdrawIndex').value;
			if (withdrawIndex >= 0) {
				try {
					await contract.methods.executeScheduledWithdraw(withdrawIndex).send({ from: account });
					alert("Withdrawal executed successfully!");
				} catch (error) {
					console.error("Error executing withdrawal:", error);
					alert("Error executing withdrawal. Check console for details.");
				}
			} else {
				alert("Please enter a valid withdrawal index.");
			}
		}

		// Call the function when the child clicks a button, providing the correct index of the scheduled withdrawal


		// Cancel Schedule Withdraw
		const cancelWithdrawalForm = document.getElementById('cancelWithdrawalForm');
		cancelWithdrawalForm.addEventListener('submit', async (e) => {
			e.preventDefault();
			const withdrawalIndex = document.getElementById('withdrawalIndex').value;
			const accounts = await web3.eth.getAccounts();
			const sender = accounts[0];

			contract.methods.cancelScheduleWithdraw(withdrawalIndex).send({
				from: sender
			})
				.then((receipt) => {
					document.getElementById('cancelResponse').innerText = `Scheduled withdrawal at index ${withdrawalIndex} canceled successfully.`;
				})
				.catch((error) => {
					document.getElementById('cancelResponse').innerText = `Error: ${error.message}`;
				});
		});

		document.getElementById('withdrawForm').addEventListener('submit', async function (e) {
			e.preventDefault(); // Prevent form from submitting the default way

			const childAddress = document.getElementById('childAddress').value;
			const amount = document.getElementById('amountWithdraw').value;
			const unlockDate = document.getElementById('unlockTime').value;

			// Convert unlock date to Unix timestamp
			const unlockTimestamp = Math.floor(new Date(unlockDate).getTime() / 1000);

			// Convert amount to Wei (smallest Ether unit)
			const weiAmount = web3.utils.toWei(amount.toString(), 'ether');

			// Get the parent (the current connected account) from MetaMask
			const accounts = await web3.eth.getAccounts();
			const parentAccount = accounts[0];

			// Call the addScheduleWithdrawForChild function
			try {
				await contract.methods.addScheduleWithdrawForChild(childAddress, weiAmount, unlockTimestamp)
					.send({ from: parentAccount });

				alert(`Scheduled withdrawal of ${amount} ETH for child ${childAddress}, to be unlocked on ${unlockDate}`);
			} catch (error) {
				console.error(error);
				alert('Error scheduling withdrawal. See console for details.');
			}
		});

		async function instantTransfer() {
			const to = document.getElementById('instantTransferTo').value;
			const amount = document.getElementById('instantTransferAmount').value;
			const accounts = await web3.eth.getAccounts();
			try {
				await contract.methods.instantTransfer(to, web3.utils.toWei(amount, 'ether')).send({ from: accounts[0] });
				document.getElementById('status').innerText = 'Transfer successful';
			} catch (error) {
				console.error(error);
				document.getElementById('status').innerText = 'Transfer failed';
			}
		}

		async function cancelScheduledTransfer() {
			const index = document.getElementById('cancelTransferIndex').value;
			const accounts = await web3.eth.getAccounts();
			try {
				const result = await contract.methods.cancelScheduledTransfer(index).send({ from: accounts[0] });
				console.log('Transaction result:', result);
				document.getElementById('status').innerText = 'Scheduled transfer cancelled successfully';
				// Refresh the pending transfers display
				await displayPendingTransfers();
			} catch (error) {
				console.error('Error details:', error);
				document.getElementById('status').innerText = 'Failed to cancel scheduled transfer: ' + error.message;
			}
		}

		async function scheduleAutoExecution() {
			const to = document.getElementById('autoScheduleTransferTo').value;
			const amount = document.getElementById('autoScheduleTransferAmount').value;
			const unlockTime = Math.floor(new Date(document.getElementById('autoScheduleTransferUnlockTime').value).getTime() / 1000);
			const accounts = await web3.eth.getAccounts();

			if (isNaN(amount) || parseFloat(amount) <= 0 || isNaN(unlockTime)) {
				document.getElementById('status').innerText = 'Invalid amount or unlock time';
				return;
			}

			try {
				await contract.methods.scheduleAutoExecution(to, web3.utils.toWei(amount, 'ether'), unlockTime).send({ from: accounts[0] });
				document.getElementById('status').innerText = 'Auto execution transfer scheduled';
			} catch (error) {
				console.error(error);
				document.getElementById('status').innerText = 'Failed to schedule auto execution transfer: ' + error.message;
			}
		}

		async function executeAutoScheduledTransfers() {
			const accounts = await web3.eth.getAccounts();
			try {
				const receipt = await contract.methods.executeAutoScheduledTransfers().send({ from: accounts[0] });
				const gasUsed = receipt.gasUsed;
				document.getElementById('status').innerText = `Auto scheduled transfers executed. Gas used: ${gasUsed}`;
			} catch (error) {
				console.error(error);
				document.getElementById('status').innerText = 'Failed to execute auto scheduled transfers: ' + error.message;
			}
		}

		async function getAllScheduledTransfers() {
			const accounts = await web3.eth.getAccounts();
			try {
				const result = await contract.methods.getAllScheduledTransfers().call({ from: accounts[0] });
				const { receivers, amounts, unlockTimes, activeStatuses } = result;

				let html = '<h3>All Scheduled Transfers:</h3>';
				for (let i = 0; i < receivers.length; i++) {
					const status = activeStatuses[i] ? 'Active' : 'Inactive';
					const unlockDate = new Date(unlockTimes[i] * 1000);
					const now = new Date();
					const timeRemaining = unlockDate > now ?
						`(${formatTimeRemaining(unlockDate - now)} remaining)` :
						'(Ready for execution)';

					html += `
                <div style="margin-bottom: 15px; padding: 10px; border: 1px solid #ccc; border-radius: 5px;">
                    <strong>Transfer #${i + 1}</strong><br>
                    Recipient: ${receivers[i]}<br>
                    Amount: ${parseFloat(web3.utils.fromWei(amounts[i], 'ether')).toFixed(4)} ETH<br>
                    Unlock Time: ${unlockDate.toLocaleString()} ${timeRemaining}<br>
                    Status: ${status}
                </div>
            `;
				}

				document.getElementById('status').innerHTML = html;
			} catch (error) {
				console.error(error);
				document.getElementById('status').innerText = 'Failed to get all scheduled transfers: ' + error.message;
			}
		}

		function formatTimeRemaining(ms) {
			const seconds = Math.floor(ms / 1000);
			const minutes = Math.floor(seconds / 60);
			const hours = Math.floor(minutes / 60);
			const days = Math.floor(hours / 24);

			if (days > 0) return `${days} day${days > 1 ? 's' : ''}`;
			if (hours > 0) return `${hours} hour${hours > 1 ? 's' : ''}`;
			if (minutes > 0) return `${minutes} minute${minutes > 1 ? 's' : ''}`;
			return `${seconds} second${seconds !== 1 ? 's' : ''}`;
		}




		async function getTransferHistory() {
			const user1 = document.getElementById('transferHistoryUser1').value;
			const user2 = document.getElementById('transferHistoryUser2').value;
			try {
				const history = await contract.methods.getTransferHistory(user1, user2).call();
				const formattedHistory = history.map(transfer => ({
					sender: transfer.sender,
					receiver: transfer.receiver,
					amount: web3.utils.fromWei(transfer.amount, 'ether'),
					timestamp: new Date(transfer.timestamp * 1000).toLocaleString()
				}));
				document.getElementById('status').innerHTML = '<h3>Transfer History:</h3>' +
					formattedHistory.map(t => `<p>From: ${t.sender}<br>To: ${t.receiver}<br>Amount: ${t.amount} ETH<br>Date: ${t.timestamp}</p>`).join('<hr>');
			} catch (error) {
				console.error(error);
				document.getElementById('status').innerText = 'Failed to get transfer history';
			}
		}

		async function getAllTransferHistory() {
			const user = document.getElementById('allTransferHistoryUser').value;
			try {
				const history = await contract.methods.getAllTransferHistory(user).call();
				const formattedHistory = history.map(transfer => ({
					sender: transfer.sender,
					receiver: transfer.receiver,
					amount: web3.utils.fromWei(transfer.amount, 'ether'),
					timestamp: new Date(transfer.timestamp * 1000).toLocaleString()
				}));
				document.getElementById('status').innerHTML = '<h3>All Transfer History:</h3>' +
					formattedHistory.map(t => `<p>From: ${t.sender}<br>To: ${t.receiver}<br>Amount: ${t.amount} ETH<br>Date: ${t.timestamp}</p>`).join('<hr>');
			} catch (error) {
				console.error(error);
				document.getElementById('status').innerText = 'Failed to get all transfer history';
			}
		}

		async function getTransferDetails() {
			const user = document.getElementById('transferDetailsUser').value;
			const index = document.getElementById('transferDetailsIndex').value;
			try {
				const details = await contract.methods.getTransferDetails(user, index).call();
				const formattedDetails = {
					sender: details.sender,
					receiver: details.receiver,
					amount: web3.utils.fromWei(details.amount, 'ether'),
					timestamp: new Date(details.timestamp * 1000).toLocaleString()
				};
				document.getElementById('status').innerHTML = '<h3>Transfer Details:</h3>' +
					`<p>From: ${formattedDetails.sender}<br>To: ${formattedDetails.receiver}<br>Amount: ${formattedDetails.amount} ETH<br>Date: ${formattedDetails.timestamp}</p>`;
			} catch (error) {
				console.error(error);
				document.getElementById('status').innerText = 'Failed to get transfer details';
			}
		}

		async function getTotalTransactionAmount() {
			const sender = document.getElementById('totalAmountSender').value;
			const receiver = document.getElementById('totalAmountReceiver').value;
			try {
				const amount = await contract.methods.getTotalTransactionAmount(sender, receiver).call();
				const formattedAmount = web3.utils.fromWei(amount, 'ether');
				document.getElementById('status').innerHTML = '<h3>Total Transaction Amount:</h3>' +
					`<p>From: ${sender}<br>To: ${receiver}<br>Total Amount: ${formattedAmount} ETH</p>`;
			} catch (error) {
				console.error(error);
				document.getElementById('status').innerText = 'Failed to get total transaction amount';
			}
		}
		async function pauseContract() {
			const accounts = await web3.eth.getAccounts();
			try {
				await contract.methods.pause().send({ from: accounts[0] });
				document.getElementById('status').innerText = 'Contract paused successfully';
			} catch (error) {
				console.error(error);
				document.getElementById('status').innerText = 'Failed to pause contract: ' + error.message;
			}
		}

		async function unpauseContract() {
			const accounts = await web3.eth.getAccounts();
			try {
				await contract.methods.unpause().send({ from: accounts[0] });
				document.getElementById('status').innerText = 'Contract unpaused successfully';
			} catch (error) {
				console.error(error);
				document.getElementById('status').innerText = 'Failed to unpause contract: ' + error.message;
			}
		}

	// Interest Module -- Start
        // Refresh account information
        async function refreshAccountInfo() {
            const accounts = await web3.eth.getAccounts();
            const sender = accounts[0];
            const balance = await contract.methods.getAccountBalances().call({ from: sender }); // Fixed accounts[0]
            document.getElementById("account-balance").innerText = web3.utils.fromWei(balance, "ether") + " ETH";

            accrualInterval = await contract.methods.getUserAccrualInterval().call({ from: sender });
			if(accrualInterval == 31536000){
				accrualInterval = "Yearly";
			}else if(accrualInterval == 2592000){
				accrualInterval = "Monthly";
			}else if (accrualInterval == 30){
				accrualInterval = "Testing (30 seconds)";
			}
            document.getElementById("accrual-interval").innerText = accrualInterval;

            const interestRate = await contract.methods.getAccountInterestRates().call({ from: sender });
            document.getElementById("interest-rate").innerText = interestRate + "%";
        }

        // Calculate interest
        document.getElementById("calculate-interest").addEventListener('click', async () => {
            const calcAmount = document.getElementById("calc-amount").value;
            const amount = web3.utils.toWei(calcAmount, "ether");
            console.log(amount);
            const startTimes = document.getElementById("startTime").value;
            const endTimes = document.getElementById("endTime").value;

            // Convert to Date objects
            const startDate = new Date(startTimes);
            const endDate = new Date(endTimes);

            // Convert to epoch time in seconds
            const startEpoch = Math.floor(startDate.getTime() / 1000);
            const endEpoch = Math.floor(endDate.getTime() / 1000);
            console.log(startEpoch);
			console.log(endEpoch);

            try {
                const result = await contract.methods.interestCalculator(amount, startEpoch, endEpoch).call(); // Adjust start and end epochs
                document.getElementById("interest-test").innerText = web3.utils.fromWei(result[0], "ether") + " ETH";
                document.getElementById("interest-month").innerText = web3.utils.fromWei(result[1], "ether") + " ETH";
                document.getElementById("interest-year").innerText = web3.utils.fromWei(result[2], "ether") + " ETH";
            } catch (error) {
                console.error("Error calculating interest:", error);
            }
        });

		//


        // Add interest
        document.getElementById("add-interest").addEventListener('click', async () => {
            const accounts = await web3.eth.getAccounts();
            const sender = accounts[0];
            try {
                await contract.methods.addInterest().send({ from: sender });
                document.getElementById("add-interest-status").innerText = "Interest added successfully!";
            } catch (error) {
                document.getElementById("add-interest-status").innerText = "Error adding interest.";
                console.error(error);
            }
        });

        // Withdraw interest
        document.getElementById("withdraw-interest").addEventListener('click', async () => {
			const accounts = await web3.eth.getAccounts();
            const sender = accounts[0];
            try {
                await contract.methods.withdrawInterest().send({ from: sender });
                document.getElementById("withdraw-interest-status").innerText = "Interest withdrawn successfully!";
            } catch (error) {
                document.getElementById("withdraw-interest-status").innerText = "Error withdrawing interest.";
                console.error(error);
            }
        });

        // Distribute interest
        document.getElementById("distribute-interest").addEventListener('click', async () => {
			const accounts = await web3.eth.getAccounts();
            const sender = accounts[0];
            const percentage = document.getElementById("distribute-percentage").value; // Corrected ID
            const recipientAddress = document.getElementById("Recipient-Address").value;

            try {
                await contract.methods.distributeInterest(percentage, recipientAddress).send({ from: sender });
                document.getElementById("distribute-interest-status").innerText = "Interest distributed successfully!"; // Corrected ID
            } catch (error) {
                document.getElementById("distribute-interest-status").innerText = "Error distributing interest."; // Corrected ID
                console.error(error);
            }
        });

        // Change accrual interval
		document.getElementById("change-interval").addEventListener('click', async () => {
			const accounts = await web3.eth.getAccounts();
            const sender = accounts[0];
            const selectedInterval = document.getElementById("interval-select").value;

            try {
                await contract.methods.setUserAccrualInterval(selectedInterval).send({ from: sender });
                document.getElementById("change-interval-status").innerText = "Interval changed successfully!";
            } catch (error) {
                document.getElementById("change-interval-status").innerText = "Error changing interval.";
                console.error(error);
            }
        });

		// Get Interest History
		async function getInterestHistory() {
			const accounts = await web3.eth.getAccounts();
			const sender = accounts[0];
			console.log(sender);

			// Clear previous history display
			document.getElementById("withdrawal-history").innerHTML = ''; 
			document.getElementById("distribution-history").innerHTML = ''; 
			document.getElementById("add-interest-history").innerHTML = '';

			// Get withdrawal history
			try {
				const withdrawalHistory = await contract.methods.getWithdrawalHistory().call({ from: sender });
				withdrawalHistory.forEach(item => {
					const li = document.createElement("li");
					const interestInEther = web3.utils.fromWei(item.interestAmount.toString(), 'ether'); // Convert Wei to Ether
					li.textContent = `Date & Time: ${new Date(item.timestamp * 1000).toLocaleString()}, Interest Amount: ${interestInEther} ETH, Recipient: ${item.recipient}`;
					document.getElementById("withdrawal-history").appendChild(li);
				});
			} catch (error) {
				console.error("Error fetching withdrawal history:", error);
			}

			// Get distribution history
			try {
				const distributionHistory = await contract.methods.getDistributionHistory().call({ from: sender });
				distributionHistory.forEach(item => {
					const li = document.createElement("li");
					const interestInEther = web3.utils.fromWei(item.interestAmount.toString(), 'ether'); // Convert Wei to Ether
					li.textContent = `Date & Time: ${new Date(item.timestamp * 1000).toLocaleString()}, Interest Amount: ${interestInEther} ETH, Recipient: ${item.recipient}`;
					document.getElementById("distribution-history").appendChild(li);
				});
			} catch (error) {
				console.error("Error fetching distribution history:", error);
			}

			// Get Add Interest history
			try {
				const addInterestHistory = await contract.methods.getUserAddInterestHistory().call({ from: sender });
				addInterestHistory.forEach(item => {
					const li = document.createElement("li");
					const interestInEther = web3.utils.fromWei(item.interestAmount.toString(), 'ether'); // Convert Wei to Ether
					li.textContent = `Date & Time: ${new Date(item.timestamp * 1000).toLocaleString()}, Interest Amount: ${interestInEther} ETH, Recipient: ${item.recipient}`;
					document.getElementById("add-interest-history").appendChild(li);
				});
			} catch (error) {
				console.error("Error fetching add interest history:", error);
			}
		}

		
        // Interest Module -- End 
	</script>
</body>

</html>
